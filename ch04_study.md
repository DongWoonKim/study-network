# ch_04 웹사이트의 동작 원리

### 웹사이트는 어떻게 생겼을까?

> <strong>웹사이트</strong>란 웹서버 애플리케이션이 공개하는 다양한 웹페이지의 집합이다. 웹사이트를 만들려면 웹서버에 애플리케이션을 설치하고, 공개할 웹페이지를 결정할 필요가 있다.

##### 웹사이트를 본다는 것

> 1. 웹브라우저에서 웹사이트 주소를 입력하거나 링크를 클릭하면, 웹서버 애플리케이션에 파일 전송 요청을 보낸다.
> 2. 웨서버 애플리케이션은 요청받은 파일을 응답으로 돌려보낸다.
> 3. 웹브라우저에서 수신한 파일을 표시하면서 웹사이트를 볼 수 있게 된다.
>
> 웹페이지 파일 전송에 이용하는 TCP/IP의 애플리케이션층 프로토콜은 HTTP이다. 애플리케이션층에서 인터넷층까지 프로토콜의 조합은 웹브라우저도 웹서버 애플리케이션도 모두 같다. 최하층인 네트워크 인터페이스층 프로토콜은 같은 것을 사용할 필요는 없다.

| 프로토콜  |         layer         |
| :-------: | :-------------------: |
|   HTTP    |    애플리케이션층     |
|    TCP    |     트랜스포트층      |
|    IP     |       인터넷층        |
| 이더넷 등 | 네트워크 인터페이스층 |





### 웹서버와 웹애플리케이션 서버의 차이 

###### 참조 : https://binux.tistory.com/32

##### static pages(정적 페이지)

> - html, css, javascript, image 파일과 같이 컴퓨터에 저장된 파일들을 의미한다.
> - 요청이 있을 때마다 웹 서버에서 요청에 맞는 페이지를 응답한다.
> - 웹 서버에서 제공한다.

##### dynamic pages(동적 페이지)

> - 요청에 맞게 동적으로 만들어진 컨텐츠를 뜻한다.
> - 데이터베이스, 서버 내의 로직 등을 활용해 만들어진 컨텐츠를 반환한다.
> - 웹 애플리케이션 서버에서 제공한다.



##### Web Server 웹 서버

> <strong>HTTP 요청을 받아 static contents 를 제공하는 서버, 프로그램</strong>
>
> HTTP프로토콜을 기반으로 하여 클라이언트의 요청을 서비스하는 기능을 담당 (ex Apache Server, Nginx, ..)
>
> 기능1 : 정적 컨텐츠 제공 : WAS를 거치지 않고, 바로 요청한 컨텐츠를 제공할 수 있다.
>
> 기능2 : 동적인 컨텐츠 제공을 위한 요청 전달 : 요청을 WAS에 보내고, WAS가 처리한 결과를 클라이언트에게 전달한다.

##### WAS(Web Application Server) 웹 애플리케이션 서버

> <strong>다양한 서버 내의 알고리즘, 비즈니스 로직, DB 조회 등 클라이언트 요청에 따라 동적인 컨텐츠를 제공하는 서버, 프로그램</strong>
>
> HTTP프로토콜을 기반으로 하여 클라이언트의 요청에 따라 구현된 비즈니스 로직을 통해 동적으로 만들어진 컨텐츠를 반환 (ex Tomcat, JBoss, Jeus, ...)
>
> 기능 데이터베이스 접속 기능, 여러 개의 트랜잭션 관리 등 수행

##### Container 컨테이너

> 웹 서버가 보낸 JSP, PHP, ASP.net 등의 파일들을 실행하고 수행결과를 다시 웹 서버로 보내주는 역할을 한다.



정리를 해보자면 웹 애플리케이션 서버는 웹 서버에서 요청을 받고, 이를 웹 컨테이너로 보내 로직을 수행하고 그 결과를 다시 웹 서버로 보내 최종적으로 클라이언트에게 보내주는 것이다.



<img src="https://ifh.cc/g/5vsPTl.jpg" alt="l3-switch" style="zoom:50%;" />

<img src="https://ifh.cc/g/FXJbWj.jpg" alt="l3-switch" style="zoom:50%;" />



### WAS와 Web Server가 나누어져 있는 이유

##### 기능을 분리하여 서버 부하를 방지한다

> - WAS는 DB 조회, 다양한 로직 수행하느라 바쁘기 때문에 단순한 정적 컨텐츠는 Web Server에서 처리하는 것이 좋다.
> - 정적 컨텐츠 요청까지 WAS에서 수행하게 되면 부하가 커지게 되고, 동적 컨텐츠 처리가 지연됨에 따라 수행속도가 느려진다.

##### 물리적으로 분리하여 보안을 강화시킨다

> - SSL 대한 암복호화 처리에 Web Server를 사용

##### 여러 대의 WAS를 연결해 로드 밸런싱 용도로 사용할 수 있다.

> - Fail over, Fail back 처리에 유리하다.
> - 대용량 웹 어플리케이션의 경우 Web Server와 WAS를 분리하여 오류가 발생한 WAS를 사용하지 않고, 다른 WAS를 사용하게 만듦으로써 무중단 운영을 가능하게 한다.

##### 여러 언어의 웹 어플리케이션 서비스가 가능하다

> - 하나의 서버에서 PHP Application, Java Application를 함께 사용하는 등과 같이 여러 웹 어플리케이션의 활용이 가능해진다.
> - 톰캣은 Java언어만 해석이 가능하다.  PHP는 실행이 불가능하다. 하지만 Web Server로 아파치를 사용해 PHP를 사용할 수 있게 만들 수 있다.



결론적으로 자원 이용의 효율성 및 장애 극복, 배포 및 유지보수의 편의성을 위해 Web Server와 WAS를 각기 사용한다.

### 웹사이트의 주소

##### URL의 의미

> 웹사이트를 보기 위해서는 어느 웹페이지 파일을 보고 싶은지 지정해야만 한다. 전송받고 싶은 웹페이지를 지정하는 것이 웹사이트의 주소이다.
>
> 웹사이트 주소는 주로 'http://'로 시작되는 문자열로, URL(Uniform Resource Locator)라고 불린다. 정식으로는 URI(Uniform Resource Identifier)이다.
>
> URL은 `http://www.xxxx.com/network/index.html ` 이런 모양을 가진다.
>
> 맨 앞의 http는 <strong>스킴</strong>이라고, 웹브라우저가 웹서버의 데이터에 접속하기 위한 프로토콜을 나타낸다. (ex https, ftp, ...)
>
> : 뒤에는 파일이 있는 장소를 나타내고, // 는 그 뒤로 이어지는 부분이 호스트명이다. 웹서버에 접속할 때는 호스트명에서 IP주소로 변환하는 DNS의 이름해석이 필요하다.
>
> 호스트명 뒤에는 포트 번호가 이어지지만, 대부분 생략한다. 생략한 경우에는 지정된 스킴에서 프로토콜의 웰노운 포트를 사용한다. 호스트명 뒷부분이 웹서버 어디에 목적으로 하는 파일이 있는지 나타내는 경로이다.
>
> `<스킴>://<호스트명>/<경로명>`



### 웹사이트의 파일을 요청한다

##### HTML 파일 전송

> 웹사이트를 구성하는 HTML 파일을 전송하기 위해 HTTP(Hyper Text Transfer Protocol)를 이용한다. HTTP를 그대로 해석하면, 하이퍼텍스트를 전송하는 프로토콜이다. 단, HTTP는 HTML 파일뿐만 아니라, 다양한 종류의 파일을 전송하는 범용적인 프로토콜로도 이용할 수 있다. 
>
> HTTP 파일 전송은 HTTP 리퀘스트(요청)와 HTTP 리스폰스(응답)를 주고받으면서 이루어진다. HTTP는 트랜스포트층의 프로토콜로서 TCP를 이용하므로, HTTP통신을 하기 전에 TCP커넥션을 맺는다.

##### HTTP 리퀘스트

> <strong>HTTP 리퀘스트</strong>는 리퀘스트 라인, 메시지 헤더, 엔티티 바디의 세 부분으로 나뉜다. 메시지 헤더와 엔티티 바디 사이에는 공백이 있다.
>
> <strong>리퀘스트라인</strong>은 HTTP 리퀘스트의 첫 번째 줄로, 웹서버에 대한 실제 처리 요청을 전달한다. 리퀘스트 라인은 다시 메서드, URI, 버전으로 구성된다. 가장 자주 사용되는 메서드는 GET메서드이다. 웹브라우저에서 URL을 입력하거나 링크를 클릭하거나 하면 GET 메서드의 HTTP리퀘스트를 웹서버 애플리케이션으로 보내게 된다.
>
> <strong>메시지 헤더</strong>는 요청 라인에 이어지는 여러 줄의 텍스트이다. 여기에는 웹브라우저의 종류와 버전, 대응하는 데이터의 형식 등의 정보를 기술한다.
>
> 메시지 헤더 다음은 공백 라인으로 구분하고, 그 뒤로 <strong>엔티티 바디</strong>가 이어진다.
>
> <strong>엔티티 바디</strong>는 POST 메서드로 웹브라우저에서 데이터를 보낼 때 사용된다.

<img src="https://ifh.cc/g/jSzXR8.jpg" alt="l3-switch" style="zoom:50%;" />

| 메서드  |                  의미                  |
| :-----: | :------------------------------------: |
|   GET   |    URI로 지정한 데이터를 가져온다.     |
|  HEAD   | URI로 지정한 데이터의 헤더만 가져온다. |
|  POST   |        서버에 데이터를 보낸다.         |
|   PUT   |         서버에 파일을 보낸다.          |
| DELETE  |   서버의 파일을 삭제하도록 요청한다.   |
| CONNECT |     프록시 서버를 경유해 통신한다.     |



### 웹사이트의 파일을 전송한다

##### 응답으로 돌아오는 HTTP 리스폰스

> HTTP 리퀘스트에 대한 응답으로 HTTP 리스폰스를 반환한다. HTTP리스폰스는 리스폰스 라인, 메시지 헤더, 엔티티 바디로 구성된다.
>
> 리스폰스 라인은 다시 버전, 상태 코드, 설명문으로 나뉜다. 
>
> <strong>버전</strong>은 HTTP의 버전을 나타내며, 현재 주요 버전은 1.0이나 1.1이다. 
>
> <strong>상태 코드</strong>는 리퀘스트에 대한 웹서버 애플리케이션의 처리 결과를 나타내는 3자리로 된 숫자이다.
>
> <strong>설명문</strong>이란 상태 코드의 의미를 간단히 보여주는 텍스트이다.
>
> <strong>메시지 헤더</strong>는 웹서버 애플리케이션이 더 자세한 정보를 웹브라우저에 전달하기 위해 이용한다.
>
> 그 뒤로 공백 라인이 있고, 공백 라인 뒤에 엔티티 바디가 이어진다. <strong>엔티티 바디</strong>에는 웹브라우저로 돌려보낼 데이터가 들어간다. 웹브라우저에 돌려 보내는 데이터는 주로 HTML이다.

<img src="https://ifh.cc/g/V7iwJj.jpg" alt="l3-switch" style="zoom:50%;" />

##### 

| 상태 코드 값 |                             의미                             |
| :----------: | :----------------------------------------------------------: |
|     1xx      |              정보, 추가 정보가 있음을 전달한다.              |
|     2xx      |           성공, 서버가 요청을 처리했음을 전달한다.           |
|     3xx      |     리다이렉트, 다른 URI로 다시 리퀘스트하도록 요청한다.     |
|     4xx      | 클라이언트 에러. 요청에 문제가 있어 처리할 수 없음을 전달한다. |
|     5xx      | 서버 에러, 서버 쪽에 문제가 있어 처리할 수 없음을 전달한다.  |



















