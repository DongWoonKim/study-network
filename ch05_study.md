# ch_05 이더넷과 무선 LAN

### 같은 네트워크 내에서의 전송을 반복한다

##### 서버는 멀리 떨어져 있지만...

> 주위에 있는 PC나 스마트폰 등은 서버의 애플리케이션과 서로 데이터를 주고 받는다.
>
> 서버는 대개 PC나 스마트폰과는 멀리 떨어진 다른 네트워크에 접속되어 있다. 기술적인 관점에서 '네트워크'는 라우터 또는 레이어3 스위치로 구획되는 범위이다. 네트워크의 기본적인 구성은 레이어2 스위치 하나의 네트워크를 구성하고, 라우터 또는 레이어3 스위치로 각 네트워크를 서로 연결하는 것이다.

##### 같은 네트워크 내의 전송을 반복해 간다

> 다른 네트워크에 접속된 서버까지의 데이터 전송은 같은 네트워크 내의 전송을 반복해감으로써 실현한다.

##### 자주 이용하는 것은 이더넷과 무선 LAN(Wi-Fi)

> 같은 네트워크 내에서 전송하는 프로토콜을 이용하는 것이 이더넷과 무선 LAN(Wi-Fi)이다. TCP/IP 계층 구종에서 맨 아래인 네트워크 인터페이스층에 있는 프로토콜이다.



### 데이터를 전송하는 이더넷

##### 데이터를 전송하는 것이 이더넷

> 이더넷은 TCP/IP 계층에서 맨 아래인 네트워크 인터페이스층의 프로토콜이다. 
>
> 이더넷은 같은 네트워크 내의 어떤 이더넷 인터페이스부터 다른 이더넷 인터페이스까지 데이터를 전송한다. 같은 레이어2 스위치에 연결된 PC는 같은 네트워크에 접속된 것이다.

##### 유선 네트워크를 만든다

> 이더넷 인터페이스가 있는 기기끼리 연결해서, 이더넷 링크를 만들면 유선 네트워크가 된다.



### 이더넷의 규격

##### 이더넷에는 다양한 규격이 있다

> 이더넷에는 10Mbps에서부터 1000Gbps라는 매우 빠른 속도를 지원하는 다양한 규격이 있다. 규격은 <strong>IEEE802 위원회</strong>에서 결정된다. 이더넷의 다양한 규격은 주로 최대 전송 속도와 이용하는 매체(케이블)에 따라 나뉜다.

<table border>
  <thead>
    <tr>
      <th colspan=2>규격 이름</th>
      <th></th>
      <th>전송 속도</th>
      <th>전송 매체</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td colspan=2>IEEE802.3</td>
      <td >10BASE5</td>
      <td rowspan=3>10Mbps</td>
      <td >동축 케이블</td>
    </tr>
    <tr>
      <td colspan=2>IEEE802.3a</td>
      <td >10BASE2</td>
      <td>동축 케이블</td>
    </tr>
    <tr>
      <td colspan=2>IEEE802.3i</td>
      <td >10BASE-T</td>
      <td>UTP 케이블(카테고리3 이상)</td>
    </tr>    
    <tr>
      <td rowspan=2 colspan=2>IEEE802.3u</td>
      <td>1000BASE-TX</td>
      <td rowspan=2>100Mbps</td>
      <td>UTP 케이블(카테고리3 이상)</td>
    </tr>
    <tr>
      <td>1000BASE-FX</td>
      <td>광섬유 케이블</td>
    </tr>    
    <tr>
      <td rowspan=2 colspan=2>IEEE802.3z</td>
      <td>1000BASE-SX</td>
      <td rowspan=3>1000Mbps</td>
      <td>광섬유 케이블</td>
    </tr>
    <tr>
      <td>1000BASE-LX</td>
      <td>광섬유 케이블</td>
    </tr>
    <tr>
      <td colspan=2>IEEE802.3ab</td>
      <td>1000BASE-T</td>
      <td>UTP 케이블(카테고리5e 이상)</td>
    </tr>    
    <tr>
      <td colspan=2>IEEE802.3ae</td>
      <td>10GBASE-LX4</td>
      <td rowspan=2>10Gbps</td>
      <td>광섬유 케이블</td>
    </tr>
    <tr>
      <td colspan=2>IEEE802.3an</td>
      <td>10BASE-T</td>
      <td>UTP 케이블(카테고리6A 이상)</td>
    </tr>     
  </tbody>
</table>

##### 이더넷 규격의 명칭

> 이더넷의 규격의 명칭에는 IEEE802.3으로 시작되는 이름과 1000BASE-T처럼 전송 속도(전송 속도란 물리적인 신호로 데이터를 변환하여 전달하는 최대 속도이다.)와 전송 매체의 특징을 조합한 이름이 있다.
>
> 중요한 것은 전송 속도와 전송 매체이다.
>
> `1000 BASE - T` 
>
> 우선, 맨 앞의 숫자는 전송 속도를 나타낸다. 기본적으로 단위는 Mbps 단위이다. 
>
> 'BASE'는 베이스 밴드 방식이라는 의미이다. 현재는 베이스 밴드 방식 이외는 사용하지 않는다.
>
> '-' 뒤는 전송 매체나 물리 신호 변환의 특징을 나타낸다. 'T'가 있는 경우는 전송 매체로 UTP 케이블을 이용한다. UTP케이블은 흔히 말하는 LAN 케이블로 가장 자주 이용되는 전송 매체이다.
>
> 덧붙여, 초기 이더넷 규격은 BASE 뒤에 숫자가 기재된다. 숫자가 오는 경우는 전송 매체로 동축 케이블을 이용하고, 100m 단위 케이블의 최대 길이를 의미한다.



### 인터페이스는 어느 것?

##### 인터페이스를 특정한다

> 이더넷은 이더넷 인터페이스 간에 데이터를 전송하므로, 데이터를 전송하려면 이더넷 인터페이스를 특정해야만 한다. 이더넷 인터페이스를 특정하기 위해서는 <strong>MAC주소</strong>가 있다.

##### MAC 주소란?

> MAC 주소란 이더넷 인터페이스를 특정하기 위한 48비트 주소이다. MAC주소의 48비트 중 선두 24비트는 OUI, 그 뒤 24비트는 시리얼 넘버로 구성된다.
>
> OUI 이더넷 인터페이스를 제조하는 벤더(메이커) 식별 코드이다.
>
> 시리얼 넘버는 각 벤더가 할당한다.
>
> MAC주소는 이더넷 인터페이스에 미리 할당되어 있어, 기본적으로 변경할 수 없는 주소이므로 '물리 주소'나 '하드웨어 주소'라고 부르는 경우도 있다.

##### MAC 주소의 표기

> MAC 주소는 16진수로 표기한다.
>
> - 1바이트씩 16진수로 변환하고 '-'로 구분한다.
>
>   00-00-01-02-03-04
>
> - 1바이트씩 16진수로 변환하고 ':'로 구분한다.
>
>   00:00:01:02:03:04
>
> - 2바이트씩 16진수로 변환하고 '.'으로 구분한다.
>
>   0000.0102.0304



### 일반적으로 사용되는 인터페이스와 케이블은?

##### 자주 사용하는 이더넷 규격

> 이더넷에는 다앙한 규격이 있고, 규격마다 사용할 수 있는 인터페이스와 케이블이 다르다. 
>
> 다양한 이더넷 규격 중에서 가장 널리 이용되는 규격으로는 '10BASE-T', '100BASE-T', '1000BASE-T', '10GBASE-T'를 들 수 있다. 
>
> 이 규겨들 모두 <strong>RJ-45 이더넷 인터페이스</strong>와 <strong>UTP케이블</strong>을 채용하고 있다.

<table border>
  <thead>
    <tr>
      <th>카테고리</th>
      <th>최대 주파수</th>
      <th>주요 용도</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td >카테고리1</td>
      <td style="text-align:center;"> - </td>
      <td >음성 통신</td>
    </tr>  
    <tr>
      <td >카테고리2</td>
      <td style="text-align:center;"> 1MHz </td>
      <td >저속 데이터 통신</td>
    </tr>  
    <tr>
      <td >카테고리3</td>
      <td style="text-align:center;"> 16MHz </td>
      <td >
        <p><span style="display:inline-block; text-align:left;">10BASE-T</span> <span style="display:inline-block; text-align:right;">토큰링</span></p>
        <p>100BASE-T2/T4</p>
      </td>
    </tr>  
    <tr>
      <td >카테고리4</td>
      <td style="text-align:center;"> 20MHz </td>
      <td >
        <p><span style="display:inline-block; text-align:left;">카테고리3까지의 용도</span> <span style="display:inline-block; text-align:right;">ATM(25Mbps)</span></p>
        <p>토큰링(16Mbps)</p>
      </td>
    </tr>  
    <tr>
      <td >카테고리5</td>
      <td style="text-align:center;"> 100MHz </td>
      <td>
        <p><span style="display:inline-block; text-align:left;">카테고리4까지의 용도</span> <span style="display:inline-block; text-align:right;">ATM(156Mbps)</span></p>
        <p><span style="display:inline-block; text-align:left;">100BASE-TX</span> <span style="display:inline-block; text-align:right;">CDDI</span></p>        
      </td>
    </tr>  
    <tr>
      <td >카테고리5e</td>
      <td style="text-align:center;"> 100MHz </td>
      <td >
        <p>카테고리5까지의 용도</p>
        <p>1000BASE-T</p>
      </td>
    </tr>  
    <tr>
      <td >카테고리6</td>
      <td style="text-align:center;"> 250MHz </td>
      <td >
        <p><span style="display:inline-block; text-align:left;">카테고리5e까지의 용도</span> <span style="display:inline-block; text-align:right;">ATM(1.2Gps)</span></p>
        <p>ATM(622Mbps)</p>
      </td>
    </tr>  
    <tr>
      <td >카테고리6A</td>
      <td style="text-align:center;"> 500MHz </td>
      <td >10BASE-T</td>
    </tr>  
  </tbody>
</table>

##### UTP 케이블

> 흔히 말하는 LAN 케이블이 UTP 케이블이다.

##### RJ-45 이더넷 인터페이스

> RJ-45는 UTP 케이블용 인터페이스로서 UTP 케이블에 맞춰 8개의 단자가 있고, 전기신호(전류)가 흐르는 회로를 최대 4쌍 형성할 수 있다.



### 데이터 형식

##### 이더넷의 '데이터'

> 이더넷으로 데이터를 전송하기 위해서는 전송할 데이터에 <strong>이더넷 헤더</strong>를 붙여야 한다. 이때 이더넷 헤더뿐만 아니라, <strong>FCS</strong>도 붙게 된다. FCS는 에러 체크를 위한 것이다. 이더넷 헤더와 데이터, 그리고 FCS를 합한 전체를 <strong>이더넷 프레임</strong>이라고 부른다.
>
> 전송 대상이 되는 데이터는 64바이트에서 1500바이트 사이로 정해져 있다. 데이터 크기의 최댓값을 <strong>MTU</strong>(Maximum Transmission Unit)이라고 부른다. MTU를 넘는 크기의 데이터는 복수로 분할해서 전송하게 된다.
>
> 이더넷 헤더와 데이터 부분 및 FCS를 모두 포함한 이더넷 프레임은 64 ~ 1518바이트 범위의 크기이다.
>
> <img src="https://ifh.cc/g/AQ3Ds4.jpg" alt="l3-switch" style="zoom:30%;" />

##### 중요한 것은 MAC 주소

> 이더넷 헤더 안에는 세 가지 정보가 있다.
>
> - 목적지 MAC 주소
> - 출발지 MAC 주소
> - 타입 코드
>
> | 타입코드 | 프로토콜 |
> | -------- | -------- |
> | 0x0800   | IPv4     |
> | 0x0806   | ARP      |
> | 0x86DD   | IPv6     |



### 어떻게 접속하는가?

##### 접속 형태는 주로 세 가지

> <strong><a href='https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=brickbot&logNo=220418950837'>토폴로지</a></strong>는 네트워크에서 기기를 연결하는 형태를 나타내는 말로 사용된다. 네트워크 토폴로지, 즉 기기끼리 연결하는 형태는 주로 세 가지가 있다.
>
> - 버스형
> - 스타형
> - 링형

##### 초기 이더넷은 버스형

> 동축 케이블을 전송 매체로 하는 10BASE5나 10BASE2는 버스형 토폴로지이다. 버스형 토폴로지는 하나의 전송 매체에 각 기기가 매달린 듯한 연결 형태이다. 즉 버스형 토폴로지는 하나의 전송 매체를 복수의 기기가 공유한다. 따라서 전송 매체를 어떻게 공유할 것인지 제어해야 한다. 이더넷은 이 제어를 위해 <a href='https://security-nanglam.tistory.com/193'> CSMA/CD</a>라는 방식을 이용한다.
>
> 현재는 버스형 토폴로지에서 레이어2 스위치를 중심으로 하는 스타형 토폴로지로 옮겨가고 있다.



### CSMA/CD : 데이터 전송 타이밍 제어

##### 한 대만 데이터를 전송할 수 있다

> 전송 매체(동축 케이블)를  공유하는 초기의 버스형 토폴로지로 된 이더넷에서는 복수의 기기가 동시에 데이터를 전송할 수 없다. 어떤 순간에 데이터를 전송할 수 있는 것은 단 한 대뿐이다.

##### 빠른 쪽이 이기는 제어

> 이더넷에서 전송 매체를 어떻게 이용할지 제어해 전송 매체를 공유하는 메커니즘이 <strong>CSMA/CD</strong>(Carrier Sense Multiple Access with Collision Detector)이다. 간단히 말하면 '먼저 가는 쪽이 승리'하는 방식이다.
>
> CSMA/CD의 'CS'는 케이블이 현재 사용 중인지 감지하는 것을 가리킨다. 회선을 사용하지 않을 때 데이터를 전송한다. 만약, 충돌하면 다시 전송함으로써 하나의 전송 매체를 복수의 호스트에서 공유, 다시 말해 돌려쓸 수 있게 된다.
>
> 단 현재 이더넷에서는 CSMA/CD가 필요 없다. 현재의 이더넷은 전송 매체를 공유하는 것이 아니기 때문이다.

### 레이어2 스위치 : 이더넷 네트워크를 만든다

##### 레이어2 스위치의 역할

> 레이어2 스위치는 이더넷을 이용한 네트워크 '하나'를 구성하는 네트워크 기기이다. 레이어2 스위치를 여러 대 연결해도 하나의 네트워크이다. 단, VLAN을 이용하면 레이어2 스위치로 복수의 네트워크를 만들 수도 있다.
>
> 레이어2 스위치는 레이어2 스위치로 구성된 한 이더넷 네트워크 안에서 데이터를 전송한다. 레이어2 스위치에서의 데이터는 이더넷 프레임이다. 

##### 네트워크의 입구가 되기도 하는 레이어2 스위치

> 레이어2 스위치는 '네트워크의 입구'의 역할도 한다. 클라이언트 PC나 서버 등을 네트워크에 접속하려면 우선 레이어2 스위치와 접속해야 한다. 네트워크의 입구가 된다는 의미에서, 레이어2 스위치를 '액세스 스위치'라고 표현하기도 한다. 레이어2 스위치는 일반 가정용 제품의 경우, '스위칭 허브'라고 부르는 경우도 많다.



### 레이어2 스위치의 동작

##### 레이어2 스위치 데이터 전송의 개요

> 레이어2 스위치의 데이터 전송 동작의 흐름
>
> 1. 수신한 이더넷 프레임의 출발지 MAC주소를 <strong>MAC 주소 테이블</strong>에 등록한다.
> 2. 목적지 MAC 주소와 MAC 주소 테이블에서 전송할 포트를 결정해, 이더넷 프레임을 전송한다. MAC 주소 테이블에 존재하지 않는 MAC 주소의 경우는 수신 포트를 제외한 모든 포트로 이더넷 프레임을 전송한다.(플러딩)

##### 호스트A에서 호스트D로 이더넷 프레임을 전송하는 SW1의 동작

> 호스트A는 '목적지 MAC 주소 : D'와 '출발지 MAC 주소 : A'를 지정해 이더넷 프레임을 전송한다.
>
> SW1은 포트1에서 이더넷 프레임을 수신한다.
>
> 수신한 이더넷 프레임의 이더넷 헤더에 있는 출발지 MAC주소 A를 MAC주소 테이블에 등록한다.
>
> SW1은 포트1의 끝에 A라는 MAC주소가 접속되어 있음을 인식한다.
>
> <img src="https://ifh.cc/g/sFsSFi.jpg" alt="l3-switch" style="zoom:30%;" />

##### 호스트A에서 호스트D로 이더넷 프레임 전송 SW1의 동작 

> SW1는 목적지 MAC 주소 D를 보고, MAC 주소 테이블을 참조해서 전송해야할 포트를 판단한다.
>
> MAC주소 D는 MAC 주소 테이블에 등록되어 있지 않다.
>
> MAC 주소 테이블에 등록되지 않은 MAC 주소가 목적지로 되어 있는 이더네 프레임을 <strong>Unknown 유니캐스트 프레임</strong>이라고 부른다.
>
> Unknown 유니캐스트 프레임은 수신한 포트를 제외한 모든 포트에 전송한다. 이 동작을 <strong>플러딩</strong>이라고 한다. 레이어2 스위치의 이더넷 프레임 전송은 '모르면 일단 전송해 둔다.'라는 식으로 조금 무책임하게 동작한다. 이런 점은 라우터의 동작과 크게 다르다. 라우터의 경우는 목적지를 모르면 데이터를 파기한다.
>
> <img src="https://ifh.cc/g/iEVQSt.jpg" alt="l3-switch" style="zoom:30%;" />



##### 레이어2 스위치마다 반복한다

> SW1에서 플러딩된 호스트A에서 호스트D로 가는 이더넷 프레임을 SW2의 포트3에서 수신한다.
>
> 우선, 수신한 이더넷 프레임의 출발지 MAC 주소 A를 SW2의 MAC 주소 테이블에 등록한다.
>
> 목적지 MAC 주소 D는 아직 MAC 주소 테이블에 등록되지 않는다. 그래서 이번에도 플러딩된다. 그래서 이번에도 플러딩이된다.
>
> 수신한 포트3을 제외한 포트1과 포트2로 이더넷 프레임이 전송된다.
>
> 호스트 C는 목적지 MAC 주소를 보고 자기 앞으로 온 것이 아니므로, 이더넷 프레임을 파기한다.
>
> 호스트 D는 목적지 MAC 주소가 자기 앞으로 온 것이므로, 이더넷 프레임을 수신해 IP 등의 상위 프로토콜에서의 처리를 수행해 간다.
>
> <img src="https://ifh.cc/g/u9EBkh.jpg" alt="l3-switch" style="zoom:30%;" />

##### MAC 주소를 계속 등록하면서 전송해 간다

> 레이어2 스위치는 MAC 주소를 MAC 주소 테이블에 계속 등록하면서 이더넷 프레임을 전송해 간다.

##### 통신의 원칙은 양방향이다

> 통신은 원칙적으로 양방향이다.



##### 응답도 마찬가지로 전송한다

> 호스트A에서 호스트D로 이더넷 프레임을 전송하면, 호스트D에서 호스트A로 응답이 돌아간다.
>
> 호스트D에서 호스트A 앞으로 이더넷 프레임을 전송하면, SW2의 포트2에서 수신한다.
>
> 출발지 MAC 주소를 MAC주소 테이블에 등록한다. SW2의 MAC 주소 테이블에 새로  MAC 주소 D가 등록된다.
>
> SW2는 포트2의 끝에 MAC 주소 D가 접속되어 있다고 인식한다. 그리고 목적지  MAC주소 A와 MAC주소 테이블을 참조한다.
>
> MAC 주소 테이블에서 MAC 주소 A는 포트3 끝에 접속되어 있는 것을 알고 있으므로 포트3으로 이더넷 프레임을 전송한다.

##### 호스트D에서 호스트A로 이더넷 프레임 전송 SW1의 동작

> SW1이 호스트D에서 호스트A로 가는 이더넷 프레임을 수신하면, 출발지 MAC 주소를 MAC 주소 테이블에 등록한다. 
>
> SW1은 MAC 주소 D는 포트3 끝에 접속되어 있다고 인식하게 된다.
>
> 목적지 MAC주소 A는 MAC주소 테이블에서 포트1의 끝에 접속되어 있다고 알고 있으므로, 포트1로 전송한다.
>
> 호스트A는 SW1에서 전송된 이더넷 프레임을 수신해 상위 프로토콜 처리를 한다.



### MAC 주소 테이블 관리

##### 하나의 포트에 꼭 하나의 MAC 주소인 것은 아니다

> 하나의 포트에 반드시 하나의 MAC주소만 등록된다고는 할 수 없다. 여러 대의 스위치를 연결한 때에는 하나의 포트에 복수의 MAC주소가 등록되게 된다.
>
> SW1과 SW2는 포트3끼리 접속하고 있다. SW1의 MAC 주소 테이블의 포트3에는 SW2 아래의 MAC 주소가 등록된다. SW2의 MAC 주소 테이블도 마찬가지이다.

##### 제한 시간이 있다

> MAC 주소 테이블에 등록하는 MAC 주소 정보에는 제한 시간이 설정되어 있다. 제한 시간 값은 스위치 기기에 따라 달라지지만, 대략 5분 정도이다. 등록된 MAC 주소가 출발지로 되어 있는 데이터(이더넷 프레임)를 수시하면, 제한시간이 재설정된다. 사용자가 특별히 아무 조작도 하지 않아도 PC는 뭔가 데이터를 전송하고 있다. 그러므로 PC가 실행되는 동안은 MAC주소 테이블에 PC의 MAC 주소가 등록되어 있는 경우가 대부분이다.
>
> 또한, 유선(이더넷)으로 데이터를 전송할 때는 레이어2 스위치의 MAC 주소 테이블이 완성되길 기다릴 필요가 없다. MAC 주소 테이블이 완성되지 않으면 여분의 데이터 전송을 해야 하지만, 데이터 자체는 제대로 도착한다.















