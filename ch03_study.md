# ch_03 네트워크의 공통 언어 TCP/IP



### PC도 스마트폰도 서버도 TCP/IP를 사용한다

> TCP/IP는 TCP와 IP를 중심으로 하는 프로토콜의 집합으로, 네트워크의 공통 언어이다. PC나 스마트폰 등의 OS에도 TCP/IP가 내장되어 있으므로 간단히 이용할 수 있다. 또한 TCP/IP로 통신하는 PC와 스마트폰, 각종 네트워크 기기 전반을 __호스트__라고 부른다.



### TCP/IP 계층구조

##### TCP/IP의 계층(아래부터 최하위 계층 ~ )

|      TCP/IP의 구조       |                             설명                             |             주요프로토콜              |
| :----------------------: | :----------------------------------------------------------: | :-----------------------------------: |
|    애플리케이션 계층     |     애플리케이션에서 다룰 데이터 형식과 절차를 결정한다.     | HTTP, SMTP, POP3, IMAP4, DHCP, DNS 등 |
|     트랜스포트 계층      |              애플리케이션에 데이터를 할당한다.               |                TCP/UDP                |
|       인터넷 계층        |                   엔드투엔드 통신을 한다.                    |           IP, ICMP, ARP 등            |
| 네트워크 인터페이스 계층 | 프로토콜은 자유롭게 설정할 수 있다. 즉 통신 상대와 같은 것을 사용할 필요는 없다. |       이더넷, 무선 LAN, PPP 등        |



##### 웹 액세스의 프로토콜의 조합

<img src="https://ifh.cc/g/VJI4cu.jpg" alt="l3-switch" style="zoom:35%;" />





### 데이터를 전송하는 역할을 하는 계층

##### 네트워크 인터페이스층

> 네트워크 인터페이스층의 역할은 __같은 네트워크 안에서 데이터를 전송__하는 것이다.
>
> 기술적인 관점에서, 하나의 네트워크는 라우터와 레이어3 스위치로 구획되는 범위, 또는 레이어2 스위치로 구성하는 범위이다.

<img src="https://ifh.cc/g/i1eIhJ.jpg" alt="l3-switch" style="zoom:40%;" />



##### 인터넷층

> 많은 네트워크가 존재하고, 거기에 다양한 기기가 연결된다. 인터넷층은 그 __네트워크 사이에서 데이터를 전송__하는 역할을 한다. 
>
> 네트워크끼리 연결하고 데이터를 전송하는 기기가 __라우터__이다. 라우터에 의한 네트워크 간 전송을 가리켜 라우팅이라고 한다. 또한, 원격지 네트워크에서 최종적으로 출발지와 목적지 사이의 데이터 전송을 가리켜 __엔드투엔드 통신__이라고 한다.





### 애플리케이션의 동작을 준비하는 계층

##### 트랜스포트층

> 트랜스포트층의 역할은 여러 애플리케이션의 데이터가 다양한 타이밍에 들어온 데이터를 적절한 애플리케이션에 배분하는 것이다.
>
> TCP/IP 트랜스포트층에 포함되는 프로토콜은 TCP와 UDP이다. TCP를 이요하면, 만약 어떤 이유로 데이터가 유실되더라도 그 사실을 검출해 데이터를 다시 보내준다. 
>
> TCP에는 엔드투엔드의 신뢰성을 확보해 주는 기능이 있다. 그 밖에도 데이터의 분할과 조립 등도 한다.



##### 애플리케이션층

> 애플리케이션층의 역할은 애플리케이션의 기능을 실행하기 위한 데이터의 형식과 처리 절차 등을 결정 것이다. 문자와 이미지 등 인간이 인식할 수 있도록 데이터를 표현한다.



### 데이터 송수신 규칙

##### 프로토콜의 제어정보 '헤더'를 만든다

> 통신 주체인 애플리케이션이 데이터를 주고받게 하려면, 복수의 프로토콜을 조합할 필요가 있다. TCP/IP에서는 네 개의 프로토콜을 조합한다. 
>
> 각 프로토콜에는 각각의 기능을 실현하기 위한 제어 정보(헤더)가 필요하다. 예를들어 데이터를 전송하는 프로토콜이라면, 헤더에는 출발지와 목적지 주소가 지정된다. 각 프로토콜은 데이터를 전송할 때 헤더를 추가한다. 헤더를 추가하는 처리를 캡슐화라고 한다.
>
> 프로토콜이 데이터를 받으면, 각 프로토콜 헤더를 바탕으로 적절하게 처리하여 헤더를 벗겨내고 다시다른 프로토콜로 처리를 넘긴다. 이런 동작을 __역 캡슐화__ 또는 __비 캡슐화__라고 부른다.

<img src="https://ifh.cc/g/GiaOTL.jpg" alt="l3-switch" style="zoom:40%;" />

데이터 수신은 각 계층의 프로토콜이 각각의 헤더를 해석하고 헤더를 제거해서 상위 프로토콜로 데이터 처리를 넘겨준다.



##### 물리적인 신호로 변환된다.

> 웹 브라우저의 데이터는 우선 HTTP 헤더로 캡슐화되어 TCP로 넘어간다. TCP 헤더가 추가되고 다시 IP 헤더가 추가된다. 마지막으로 이더넷 헤더와 FCS(Frame Check Sequence)가 추가되면 네트워크로 내보낼 데이터 전체가 완성된다. FCS는 에러 체크를 위한 정보이다.



### 데이터를 부르는 방법은 다양하다

##### 계층별로 데이터를 부르는 방법

- 애플리케이션층 : 메시지 (HTTP 메시지)
- 트랜스포트층 : 세그먼트 또는 데이터그램 (TCP를 이요할 때 세그먼트, UDP를 이용할 때 데이터그램이라고 부른다.)
- 인터넷층 : 패킷 또는 데이터그램(IP패킷 또는 IP데이터그램이라고 부른다.)
- 네트워크 인터페이스층 : 프레임(이더넷 프레임)



### 데이터를 목적지까지 전송한다

##### IP(Internet Protocol)란?

> IP의 역할은 '엔드투엔드 통신'을 하는 것이다. 네트워크 상의 어떤 PC에서 다른 PC 등으로 데이터를 전송하는 것이 IP의 역할이다.

##### IP주소의 개요

> IP주소란 TCP/IP에서 통신 상대가 되는 호스트를 식별하기 위한 식별 정보이다.



### 목적지는 하나? 여러개?

- 유니캐스트

  >단 한 곳으로 데이터를 전송하는 것.

- 브로드캐스트

  >같은 네트워크 상의 모든 호스트에 완전히 똑같은 데이터를 전송하는 것

- 멀티캐스트

  > 같은 애플리케이션이 동작하는 등 특정 그룹에 포함되는 호스트에 환전히 똑같은 데이터를 전송하는 것



### IP주소의 구성

##### 유니캐스트 IP주소의 구성

> PC와 서버 등 TCP/IP 통신을 하는 호스트에 설정하는 IP주소는 유니캐스트 IP주소 이다. TCP/IP 통신의 대부분은 유니캐스트이다.
>
> IP주소는 __네트워크부__와 __호스트부__라는 두 개의 부분으로 구성된다. ('네트워크부'는 '네트워크 주소', '호스트부'는 '호스트 주소'라고 표현하기도 한다.)

##### 브로드캐스트 IP 주소

> 네트워크에 모든 호스트에 일괄적으로 데이터를 전송할 때 이용하는 브로드캐스트 IP주소는 32비트가 모두 '1'인 IP 주소이다. 도트형 10진 표기로 '255.255.255.255'가 브로드캐스트 주소이다. (유니캐스트 IP 주소 후반 호스트부에서 모든 비트가 1로 된 IP 주소도 브로드캐스트 IP주소이다.)

##### 멀티캐스트 IP주소

> 멀티캐스트 IP주소로서 '224.0.0.0 ~ 239.255.255.255'로 범위가 정해져 있다.



### IP주소의 범위 구분

##### 서브넷 마스크란?

> IP 주소는 전반적의 네트워크부와 후반의 호스트부로 구성된다. 네트워크부와 호스트부의 구분은 고정된 것이 아니라 가변적이다. 32비트 주소의 어디까지가 네트워크부인지 명시한 것이 __서브넷 마스크__이다. 서브넷 마스크는 IP 주소처럼 32비트이므로 '0'과 '1'이 32개 나열된다. '1'은 네트워크부를, '0'은 호스트부를 나타낸다.
>
> 서브넷 마스크는 반드시 연속한 '1'과 연속한 '0' 이다. 교대로 나타나는 서브넷 마스크는 없다.
>
> 또한 / 뒤에 연속한 '1'의 개수로 표기하는 경우도 있는데 __프리픽스 표기__라고 부른다.
>
> 192.168.1.1 255.255.255.0 -> 192.168.1.1/24

예)

|               | 네트워크부                    | 호스트부  |
| ------------- | ----------------------------- | --------- |
| IP 주소       | 1100 0000 1010 1000 0000 0001 | 0000 0001 |
| 서브넷 마스크 | 1111 1111 1111 1111 1111 1111 | 0000 0000 |



##### 네트워크 주소와 브로드캐스트 주소

>IP주소 후반 호스트를 모두 비트 '0'으로 채우면 네트워크 주소가 되고,
>
>호스트부를 모두 '1'로 채우면 브로드캐스트 주소가된다.



### 네트워크에 접속하는 두 단계

##### 물리적인 접속과 논리적인 접속

> 네트워크에 접속할 때 '물리적인 접속'과 '논리적인 접속'이라는 두 개의 단계가 있다.
>
> TCP/IP의 계층으로 말하면, 물리적인 접속은 네트워크 인터페이스층이고, 논리적인 접속은 이더넷층이다.
>
> 물리적인 접속이란 물리적인 신호를 주고받을 수 있게하는 것이다. 그리고 물리적으로 접속이 이루어진 후에, 논리적인 접속으로 IP 주소 설정도 필요해진다. 그래서 DHCP 등의 기술로 자동을 설정하게 하고, 사용자에게 IP주소 설정을 의식하지 않게 하는 경우가 많다.
>
> 즉 LAN 케이블을 꽂아 물리적인 접속이 완료되면, 자동으로 논리적인 접속도 완료할 수 있게된다.



